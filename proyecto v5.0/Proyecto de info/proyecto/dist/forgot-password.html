<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PC Multimedia</title>
    <script type="module" crossorigin src="/assets/modulepreload-polyfill-B5Qt9EMX.js"></script>
    <link rel="stylesheet" crossorigin href="/assets/main-CQnBzoBq.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body class="bg-gray-600 min-h-screen flex items-center justify-center">
  <div class="bg-white p-8 rounded-lg shadow-md w-full max-w-md">
    <h2 class="text-2xl font-bold text-center text-gray-800 mb-8">Olvidé mi contraseña</h2>
    <form id="resetPassForm" class="space-y-6" action="/forgot-password" method="POST">
      <div>
        <label for="id" class="block text-sm font-medium text-gray-700">Correo electrónico</label>
        <input type="email" id="email" name="email" required 
               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
      </div>

      <div class="flex items-center justify-between">
        <button id="send" type="submit" 
                class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
          Enviar link de restablecimiento
        </button>
      </div>
    </form>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('resetPassForm');

            if (form) {
                form.addEventListener('submit', async (event) => {
                    event.preventDefault();

                    const email = document.getElementById('email').value;

                    try {
                        const response = await fetch('/forgot-password', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ email })
                        });

                        const data = await response.json();

                        if (response.ok && data.success) {
                            Swal.fire({
                                icon: 'success',
                                title: '¡Enlace Enviado!',
                                text: data.message || 'Si tu correo está registrado, recibirás un enlace para restablecer tu contraseña en breve.',
                                confirmButtonText: 'Entendido',
                                timer: 2000,
                                timerProgressBar: true,

                                showClass: { popup: 'animate__animated animate__fadeInDown' },
                                hideClass: { popup: 'animate__animated animate__fadeOutUp' },
                                didClose: () => {
                              
                                  window.location.href = '/index';  
                                }
                            });
                        } else {
                            Swal.fire({
                                icon: 'info',
                                title: 'Solicitud Recibida',
                                text: data.message || 'Si el correo electrónico proporcionado está registrado, se te enviará un enlace para restablecer tu contraseña.',
                                confirmButtonText: 'Ok',
                                showClass: { popup: 'animate__animated animate__fadeInDown' },
                                hideClass: { popup: 'animate__animated animate__fadeOutUp' }
                            });
                        }

                    } catch (error) {
                        console.error('Error de red o del servidor:', error);
                        Swal.fire({
                            icon: 'error',
                            title: 'Error de Conexión',
                            text: 'No se pudo conectar con el servidor. Por favor, verifica tu conexión o inténtalo de nuevo.',
                            confirmButtonText: 'Cerrar',
                            showClass: { popup: 'animate__animated animate__zoomIn' },
                            hideClass: { popup: 'animate__animated animate__zoomOut' }
                        });
                    }
                });
            }
        });
    
  </script>
</body>
</html>