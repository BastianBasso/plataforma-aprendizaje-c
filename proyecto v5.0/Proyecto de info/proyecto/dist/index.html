<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Plataforma C</title>
  <link rel="stylesheet" crossorigin href="/assets/main-CQnBzoBq.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    /* Left panel visual theme */
    .left-panel {
      background: linear-gradient(135deg,#0f172a 0%, #312e81 60%, #4f46e5 100%);
      color: #fff;
      border-radius: 12px;
      position: relative;
      overflow: hidden;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:240px;
    }
    .bit-pattern {
      position:absolute;
      inset:0;
      background-image:
        radial-gradient(#9fa8ff 1px, transparent 1px),
        radial-gradient(rgba(255,255,255,0.06) 1px, transparent 1px);
      background-size: 10px 10px, 20px 20px;
      opacity:0.35;
      mix-blend-mode: overlay;
      pointer-events:none;
    }
    .big-C {
      font-weight:900;
      font-size:10rem;
      line-height:1;
      letter-spacing: -0.05em;
      background: repeating-linear-gradient(90deg, #c7d2fe 0 2px, #6366f1 2px 6px);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      filter: drop-shadow(0 6px 14px rgba(15,23,42,0.6));
      text-rendering: optimizeLegibility;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      transform: translateX(6px);
    }
    /* Card layout */
    .auth-card {
      display:flex;
      gap:24px;
      border-radius:12px;
      overflow:hidden;
      box-shadow: 0 10px 30px rgba(2,6,23,0.45);
      max-width:1220px;
      width:100%;
    }
    .right-panel {
      padding:28px;
      background: #fff;
      min-width:320px;
      flex:1;
    }

    /* Segmented control */
    .segmented button { 
        padding:8px 18px;
        border-radius:999px;
        border:none;
        cursor:pointer;
        font-weight:600;
     }
    .segmented .active {
      background: linear-gradient(90deg,#2563eb,#4f46e5);
      color:#fff;
      box-shadow: 0 6px 18px rgba(79,70,229,0.2);
    }
    .segmented .inactive {
      background: #eef2ff;
      color:#1e293b;
    }
    /* password eye */
    .password-wrapper { position:relative; }
    .toggle-eye {
      position:absolute;
      right:8px;
      top:50%;
      transform:translateY(-50%);
      background:transparent;
      border:none;
      cursor:pointer;
      padding:6px;
      display:flex;
      align-items:center;
    }
    /* smaller adjustments */
    @media (max-width: 880px) {
      .auth-card { flex-direction:column; }
      .left-panel { min-height:180px; padding:12px; }
      .big-C { font-size:6.5rem; }
    }
  </style>
</head>

<body class="bg-gray-600 min-h-screen flex items-center justify-center p-6">
  <div class="auth-card bg-white w-full max-w-4xl">
    <!-- Left visual panel -->
    <div class="left-panel w-1/2 md:w-1/2">
      <div class="bit-pattern" aria-hidden="true"></div>
      <div aria-hidden="true" class="big-C">C</div>
    </div>

    <!-- Right functional panel -->
    <div class="right-panel w-1/2 md:w-1/2">
      <h2 class="text-2xl font-bold text-gray-800 mb-2">Bienvenido</h2>
      <br>
      <p class="text-sm text-gray-500 mb-6">
        Si eres nuevo aquí, selecciona "Registrarse" para crear tu cuenta gratis y comenzar tu primera lección en minutos.
        <br>
        Si ya eres parte de nuestra plataforma, "Ingresa" para continuar tu progreso y seguir aprendiendo con nosotros.
      </p>
      
      <br>
      
      <div class="segmented flex justify-center gap-3 mb-6">
        <button id="tab-login" class="justify-center active" onclick="window.location.href='index.html'">
                Ingresar
            </button>
        <button id="tab-register" class="" onclick="window.location.href='registro.html'">Registrarse</button>
      </div>    
      
      <br>

      <form id="loginForm" class="space-y-4" action="/login" method="POST" autocomplete="on">
        <div>
          <label for="user" class="block text-sm font-medium text-gray-700">Nombre de usuario</label>
          <input type="text" id="user" name="user" required placeholder="Ingresa tu nombre de usuario"
                 class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
        </div>

        <div class="password-wrapper">
          <label for="password" class="block text-sm font-medium text-gray-700">Contraseña</label>
          <input type="password" id="password" name="password" required placeholder="Ingresa tu contraseña"
                 class="mt-1 block w-full rounded-md border-gray-300 shadow-sm pr-10 focus:border-blue-500 focus:ring-blue-500">
          <button type="button" id="togglePassword" class="toggle-eye" aria-label="Mostrar contraseña">
            <!-- eye svg (closed/open toggled by script) -->
            <svg id="eyeOpen" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-600" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6" d="M2.5 12s3.5-7 9.5-7 9.5 7 9.5 7-3.5 7-9.5 7S2.5 12 2.5 12z"/>
            </svg>
            <svg id="eyeClosed" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-600 hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6" d="M3 3l18 18"/>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6" d="M9.88 9.88A3 3 0 0114.12 14.12"/>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6" d="M2.5 12s3.5-7 9.5-7c2.1 0 4 .6 5.6 1.6"/>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.6" d="M21.5 12s-1.6 2.9-4.6 4.6"/>
            </svg>
          </button>
        </div>

        <div class="flex items-center justify-between">
          <label class="inline-flex items-center text-sm text-gray-600">
            <input type="checkbox" name="remember" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500" />
            <span class="ml-2">Recordar contraseña</span>
          </label>
          <a href="forgot-password.html" class="text-sm text-blue-600 hover:text-blue-800">¿Olvidaste tu contraseña?</a>
        </div>

        <div>
          <button id="login" type="submit"
                  class="w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
            Ingresar
          </button>
        </div>
      </form>
      <!--  
      <div class="mt-6 border-t border-gray-100 pt-4 text-center">
        <p class="text-sm text-gray-500">¿Aún no tienes cuenta? <a href="registro.html" class="text-blue-600 hover:text-blue-800 font-medium">Regístrate</a></p>
      </div>
      -->
    </div>
  </div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const urlParams = new URLSearchParams(window.location.search);
        const authError = urlParams.get('auth_error');

        if (authError === 'true') {
            Swal.fire({
                icon: 'error',
                title: 'Acceso Denegado',
                text: 'Debes iniciar sesión para acceder a esa página.',
                confirmButtonText: 'Entendido',
                customClass: {
                    popup: 'swal2-show-from-top'
                },
                showClass: {
                    popup: 'animate__animated animate__fadeInDown'
                },
                hideClass: {
                    popup: 'animate__animated animate__fadeOutUp'
                }
            });
            history.replaceState({}, document.title, window.location.pathname);
        }

        // segmented control behavior (visual only)
        const tabLogin = document.getElementById('tab-login');
        const tabRegister = document.getElementById('tab-register');
        tabLogin.addEventListener('click', () => {
            tabLogin.classList.add('active'); tabLogin.classList.remove('inactive');
            tabRegister.classList.remove('active'); tabRegister.classList.add('inactive');
        });
        tabRegister.addEventListener('click', () => {
            // navigate to registro page or toggle visual state
            tabRegister.classList.add('active'); tabRegister.classList.remove('inactive');
            tabLogin.classList.remove('active'); tabLogin.classList.add('inactive');
            // if you prefer immediate navigation to registration page, uncomment next line:
            // window.location.href = 'registro.html';
        });

        // password show/hide
        const toggle = document.getElementById('togglePassword');
        const pwd = document.getElementById('password');
        const eyeOpen = document.getElementById('eyeOpen');
        const eyeClosed = document.getElementById('eyeClosed');
        toggle.addEventListener('click', () => {
            if (pwd.type === 'password') {
                pwd.type = 'text';
                eyeOpen.classList.add('hidden');
                eyeClosed.classList.remove('hidden');
                toggle.setAttribute('aria-label', 'Ocultar contraseña');
            } else {
                pwd.type = 'password';
                eyeOpen.classList.remove('hidden');
                eyeClosed.classList.add('hidden');
                toggle.setAttribute('aria-label', 'Mostrar contraseña');
            }
        });
    });

    document.getElementById('loginForm').addEventListener('submit', async (event) => {
        event.preventDefault();

        const usernameInput = document.getElementById('user');
        const passwordInput = document.getElementById('password');

        const user = usernameInput.value;
        const password = passwordInput.value;

        try {
            const response = await fetch('/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ user, password })
            });

            const data = await response.json();

            if (response.ok) {
                Swal.fire({
                    icon: 'success',
                    title: '¡Login con éxito!',
                    text: data.message,
                    timer: 2000,
                    timerProgressBar: true,
                    didClose: () => {
                        window.location.href = '/inicio';
                    }
                });

            } else {
                let title = 'Error de inicio de sesión';
                let icon = 'error';
                let timer = 3000;
                let timerProgressBar = true;

                if (response.status === 403) {
                    title = 'Acceso Denegado';
                    icon = 'warning';
                } else if (response.status === 401 || response.status === 404) {
                    title = 'Credenciales Incorrectas';
                    icon = 'error';
                } else if (response.status === 500) {
                    title = 'Error del Servidor';
                    icon = 'error';
                }

                Swal.fire({
                    icon: icon,
                    title: title,
                    text: data.message || 'Ha ocurrido un error inesperado al iniciar sesión.',
                    timer: timer,
                    timerProgressBar: timerProgressBar
                });
            }

        } catch (error) {
            Swal.fire({
                icon: 'error',
                title: 'Error de Conexión',
                text: 'No se pudo conectar con el servidor. Por favor, verifica tu conexión a internet o inténtalo de nuevo.',
                timer: 3000,
                timerProgressBar: true
            });
        }
    });
    console.log("Script cargado correctamente");
</script>

</body>
</html>